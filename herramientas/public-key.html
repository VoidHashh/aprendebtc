<!DOCTYPE html>
<html lang="es" data-base-path="../">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Deriva la clave p√∫blica desde una clave privada Bitcoin. Formato comprimido y no comprimido sobre secp256k1." />
  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://aprendebtc.com/herramientas/public-key.html" />
  <meta property="og:title" content="Derivar clave p√∫blica ‚Äî Herramientas | aprendebtc.com" />
  <meta property="og:description" content="Deriva la clave p√∫blica desde una clave privada Bitcoin. Formato comprimido y no comprimido sobre secp256k1." />
  <meta property="og:image" content="https://aprendebtc.com/assets/og-image.png" />
  <meta property="og:site_name" content="aprendeBTC" />
  <meta property="og:locale" content="es_ES" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Derivar clave p√∫blica ‚Äî Herramientas | aprendebtc.com" />
  <meta name="twitter:description" content="Deriva la clave p√∫blica desde una clave privada Bitcoin. Formato comprimido y no comprimido sobre secp256k1." />
  <meta name="twitter:image" content="https://aprendebtc.com/assets/og-image.png" />

  <!-- Canonical -->
  <link rel="canonical" href="https://aprendebtc.com/herramientas/public-key.html" />
  <link rel="alternate" hreflang="es" href="https://aprendebtc.com/herramientas/public-key.html" />
  <link rel="alternate" hreflang="x-default" href="https://aprendebtc.com/herramientas/public-key.html" />
<meta property="og:url" content="https://aprendebtc.com/herramientas/public-key.html" />
<meta property="og:description" content="Deriva la clave p√∫blica desde una clave privada Bitcoin. Formato comprimido y no comprimido sobre secp256k1." />
<meta property="og:site_name" content="aprendeBTC" />
<meta name="twitter:title" content="Derivar clave p√∫blica ‚Äî Herramientas | aprendebtc.com" />
<meta name="twitter:image" content="https://aprendebtc.com/assets/og-image.png" />
<link rel="alternate" hreflang="x-default" href="https://aprendebtc.com/herramientas/public-key.html" />
<title>Derivar clave p√∫blica ‚Äî Herramientas | aprendebtc.com</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="../css/main.css" />
  <link rel="stylesheet" href="../css/components.css" />
  <link rel="stylesheet" href="../css/tools.css" />
  <!-- noble-secp256k1 para operaciones de curva el√≠ptica -->
</head>
<body>
  <div data-include="header"></div>

  <div class="page-layout">
        <aside class="page-layout__sidebar" aria-label="Navegacion lateral">
      <nav class="sidebar">
        <div class="sidebar__ad-wrap">
          <div class="ad-slot ad-sidebar" id="ad-sidebar-global" aria-hidden="true"></div>
        </div>
      </nav>
    </aside>

    <main class="page-layout__content" id="main-content">
      <div class="content-inner">
        <nav class="breadcrumb" aria-label="Ruta de navegaci√≥n">
          <a href="../" class="breadcrumb__item">Inicio</a>
          <span class="breadcrumb__separator" aria-hidden="true">‚Ä∫</span>
          <a href="index.html" class="breadcrumb__item">Herramientas</a>
          <span class="breadcrumb__separator" aria-hidden="true">‚Ä∫</span>
          <span class="breadcrumb__current">Clave p√∫blica</span>
        </nav>

        <article class="article">
          <h1>Derivar clave p√∫blica</h1>
          <p style="color: var(--text-secondary); font-size: 1.05rem; margin-bottom: 1.5rem;">
            Multiplica tu clave privada por el punto generador G para obtener la clave p√∫blica.
          </p>

          <!-- Disclaimer educativo -->
          <div class="callout callout--warning" style="margin-bottom: 1.5rem;">
            <span class="callout__icon" aria-hidden="true">‚ö†Ô∏è</span>
            <div class="callout__content">
              <div class="callout__title">Herramienta educativa</div>
              <p class="callout__text">Esta herramienta es para aprendizaje. NO la uses para generar claves para fondos reales.</p>
            </div>
          </div>

          <!-- Input -->
          <div class="tool-container">
            <h2 class="tool-container__title">Clave privada</h2>
            
            <div class="tool-field">
              <label class="tool-label" for="private-key-input">Clave privada en hexadecimal (64 caracteres)</label>
              <input 
                type="text" 
                id="private-key-input" 
                class="tool-input" 
                placeholder="Introduce o genera una clave privada..."
                maxlength="64"
                style="font-family: 'JetBrains Mono', monospace;"
              />
              <span class="tool-note" id="input-status">0 / 64 caracteres</span>
            </div>

            <div class="tool-btn-row">
              <button class="tool-btn tool-btn--secondary" id="btn-generate">
                üé≤ Generar clave privada
              </button>
              <button class="tool-btn" id="btn-derive">
                üîë Derivar clave p√∫blica
              </button>
            </div>
          </div>

          <!-- Error -->
          <div class="tool-error" id="error-message" style="display: none;"></div>

          <!-- Outputs -->
          <div class="tool-container" id="output-section" style="display: none;">
            <h2 class="tool-container__title">Clave p√∫blica derivada</h2>

            <!-- Comprimida -->
            <div class="output-row" style="margin-bottom: 1.25rem;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.35rem;">
                <label class="tool-label" style="margin-bottom: 0;">Comprimida (33 bytes) ‚Äî prefijo 02 o 03</label>
                <button class="tool-btn tool-btn--secondary tool-btn--small copy-btn" data-target="output-compressed">üìã</button>
              </div>
              <div class="tool-output" id="output-compressed" style="word-break: break-all; color: var(--accent);">‚Äî</div>
              <span class="tool-note">Formato est√°ndar actual. M√°s eficiente.</span>
            </div>

            <!-- No comprimida -->
            <div class="output-row" style="margin-bottom: 1.25rem;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.35rem;">
                <label class="tool-label" style="margin-bottom: 0;">No comprimida (65 bytes) ‚Äî prefijo 04</label>
                <button class="tool-btn tool-btn--secondary tool-btn--small copy-btn" data-target="output-uncompressed">üìã</button>
              </div>
              <div class="tool-output" id="output-uncompressed" style="word-break: break-all; font-size: 0.75rem;">‚Äî</div>
              <span class="tool-note">Formato legacy. Contiene X e Y completas.</span>
            </div>

            <!-- Coordenadas -->
            <div class="tool-row" style="margin-top: 1.5rem;">
              <div class="tool-field">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.35rem;">
                  <label class="tool-label" style="margin-bottom: 0;">Coordenada X (32 bytes)</label>
                  <button class="tool-btn tool-btn--secondary tool-btn--small copy-btn" data-target="output-x">üìã</button>
                </div>
                <div class="tool-output" id="output-x" style="word-break: break-all; font-size: 0.8rem;">‚Äî</div>
              </div>
              <div class="tool-field">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.35rem;">
                  <label class="tool-label" style="margin-bottom: 0;">Coordenada Y (32 bytes)</label>
                  <button class="tool-btn tool-btn--secondary tool-btn--small copy-btn" data-target="output-y">üìã</button>
                </div>
                <div class="tool-output" id="output-y" style="word-break: break-all; font-size: 0.8rem;">‚Äî</div>
              </div>
            </div>

            <!-- Paridad de Y -->
            <div style="margin-top: 1rem; padding: 0.75rem; background: var(--bg-primary); border-radius: var(--radius-md);">
              <span class="tool-label">Paridad de Y:</span>
              <span id="y-parity" style="font-weight: 600; margin-left: 0.5rem;">‚Äî</span>
              <span id="y-parity-explanation" style="color: var(--text-secondary); font-size: 0.85rem; margin-left: 0.5rem;"></span>
            </div>
          </div>

          <!-- Proceso visual -->
          <div class="tool-container">
            <h2 class="tool-container__title">El proceso de derivaci√≥n</h2>
            
            <div style="background: var(--bg-primary); padding: 1.25rem; border-radius: var(--radius-md); text-align: center;">
              <div style="display: flex; align-items: center; justify-content: center; gap: 1rem; flex-wrap: wrap;">
                <div style="background: rgba(88, 166, 255, 0.2); padding: 1rem; border-radius: var(--radius-md);">
                  <div style="font-weight: 700; color: #58a6ff; font-size: 1.1rem;">k</div>
                  <div style="font-size: 0.75rem; color: var(--text-secondary);">Clave privada</div>
                  <div style="font-size: 0.7rem; color: var(--text-secondary);">(escalar)</div>
                </div>
                
                <div style="font-size: 1.5rem; color: var(--text-secondary);">√ó</div>
                
                <div style="background: rgba(163, 113, 247, 0.2); padding: 1rem; border-radius: var(--radius-md);">
                  <div style="font-weight: 700; color: #a371f7; font-size: 1.1rem;">G</div>
                  <div style="font-size: 0.75rem; color: var(--text-secondary);">Punto generador</div>
                  <div style="font-size: 0.7rem; color: var(--text-secondary);">(constante)</div>
                </div>
                
                <div style="font-size: 1.5rem; color: var(--text-secondary);">=</div>
                
                <div style="background: rgba(247, 147, 26, 0.2); padding: 1rem; border-radius: var(--radius-md); border: 2px solid var(--accent);">
                  <div style="font-weight: 700; color: var(--accent); font-size: 1.1rem;">P</div>
                  <div style="font-size: 0.75rem; color: var(--text-secondary);">Clave p√∫blica</div>
                  <div style="font-size: 0.7rem; color: var(--text-secondary);">(punto en curva)</div>
                </div>
              </div>
            </div>

            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 1rem; text-align: center;">
              Esta multiplicaci√≥n tarda milisegundos. El proceso inverso (encontrar k dado P) 
              es <strong>computacionalmente imposible</strong> ‚Äî esa asimetr√≠a es la base de la seguridad de Bitcoin.
            </p>
          </div>

          <!-- Par√°metros de secp256k1 -->
          <div class="tool-container">
            <h2 class="tool-container__title">Par√°metros de secp256k1</h2>
            
            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
              <div style="background: var(--bg-primary); padding: 0.75rem; border-radius: var(--radius-md);">
                <div class="tool-label" style="margin-bottom: 0.25rem;">p (campo primo)</div>
                <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.65rem; color: var(--text-secondary); word-break: break-all;">
                  FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F
                </div>
              </div>
              
              <div style="background: var(--bg-primary); padding: 0.75rem; border-radius: var(--radius-md);">
                <div class="tool-label" style="margin-bottom: 0.25rem;">G<sub>x</sub> (coordenada X del generador)</div>
                <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.65rem; color: var(--text-secondary); word-break: break-all;">
                  79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798
                </div>
              </div>
              
              <div style="background: var(--bg-primary); padding: 0.75rem; border-radius: var(--radius-md);">
                <div class="tool-label" style="margin-bottom: 0.25rem;">G<sub>y</sub> (coordenada Y del generador)</div>
                <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.65rem; color: var(--text-secondary); word-break: break-all;">
                  483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8
                </div>
              </div>
              
              <div style="background: var(--bg-primary); padding: 0.75rem; border-radius: var(--radius-md);">
                <div class="tool-label" style="margin-bottom: 0.25rem;">n (orden de la curva)</div>
                <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.65rem; color: var(--text-secondary); word-break: break-all;">
                  FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141
                </div>
              </div>
            </div>
          </div>

          <!-- Comprimida vs no comprimida -->
          <div class="tool-container">
            <h2 class="tool-container__title">¬øComprimida vs no comprimida?</h2>
            
            <p style="color: var(--text-secondary); line-height: 1.7; margin-bottom: 1rem;">
              La curva el√≠ptica secp256k1 es <strong>sim√©trica respecto al eje X</strong>. 
              Esto significa que para cualquier coordenada X, solo hay dos posibles valores de Y: 
              uno par y otro impar.
            </p>
            
            <div class="tool-table-wrapper">
              <table class="tool-table">
                <thead>
                  <tr>
                    <th>Formato</th>
                    <th>Tama√±o</th>
                    <th>Contenido</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>Comprimida</strong></td>
                    <td>33 bytes</td>
                    <td>02/03 + coordenada X (el prefijo indica paridad de Y)</td>
                  </tr>
                  <tr>
                    <td><strong>No comprimida</strong></td>
                    <td>65 bytes</td>
                    <td>04 + coordenada X + coordenada Y</td>
                  </tr>
                </tbody>
              </table>
            </div>
            
            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 1rem;">
              <strong>Hoy en d√≠a solo se usa el formato comprimido.</strong> El no comprimido es legacy de los 
              primeros tiempos de Bitcoin. Usar comprimido ahorra 32 bytes en cada transacci√≥n.
            </p>
          </div>

          <!-- Callout contextual -->
          <div class="tool-callout">
            <div class="tool-callout__title">Aprende m√°s sobre criptograf√≠a de curva el√≠ptica</div>
            <p class="tool-callout__text">
              <a href="../nivel-5/curva-eliptica.html">La curva secp256k1 ‚Üí</a> ¬∑ 
              <a href="../nivel-3/clave-publica.html">Claves p√∫blicas ‚Üí</a>
            </p>
          </div>

          <div class="ad-slot ad-content" id="ad-content-1" aria-hidden="true"></div>
        </article>
      </div>
    </main>
  </div>

  <div data-include="footer"></div>
  <script src="../js/includes.js"></script>
  <script src="../js/nav.js"></script>
  <script src="../js/search.js"></script>
  <script src="../js/hex-utils.js"></script>

    <script>
  (function() {
    'use strict';

    const SECP256K1_ORDER = BigInt('0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141');

    const privateKeyInput = document.getElementById('private-key-input');
    const inputStatus = document.getElementById('input-status');
    const btnGenerate = document.getElementById('btn-generate');
    const btnDerive = document.getElementById('btn-derive');
    const errorMessage = document.getElementById('error-message');
    const outputSection = document.getElementById('output-section');

    const outputCompressed = document.getElementById('output-compressed');
    const outputUncompressed = document.getElementById('output-uncompressed');
    const outputX = document.getElementById('output-x');
    const outputY = document.getElementById('output-y');
    const yParity = document.getElementById('y-parity');
    const yParityExplanation = document.getElementById('y-parity-explanation');

    let secpLib = null;

    function bytesToHex(bytes) {
      if (window.HexUtils && typeof window.HexUtils.bytesToHex === 'function') {
        return window.HexUtils.bytesToHex(bytes);
      }
      return Array.from(bytes).map(function(b) {
        return b.toString(16).padStart(2, '0');
      }).join('');
    }

    function generateRandomPrivateKey() {
      const bytes = new Uint8Array(32);
      crypto.getRandomValues(bytes);
      return bytesToHex(bytes);
    }

    function isValidPrivateKey(hexKey) {
      if (!/^[0-9a-fA-F]{64}$/.test(hexKey)) {
        return { valid: false, reason: 'Debe tener 64 caracteres hexadecimales' };
      }
      const keyBigInt = BigInt('0x' + hexKey);
      if (keyBigInt === 0n) {
        return { valid: false, reason: 'La clave no puede ser cero' };
      }
      if (keyBigInt >= SECP256K1_ORDER) {
        return { valid: false, reason: 'La clave excede el orden de la curva' };
      }
      return { valid: true };
    }

    async function loadSecpLib() {
      if (secpLib && typeof secpLib.getPublicKey === 'function') {
        return secpLib;
      }

      if (window.nobleSecp256k1 && typeof window.nobleSecp256k1.getPublicKey === 'function') {
        secpLib = window.nobleSecp256k1;
        return secpLib;
      }

      if (window.secp256k1 && typeof window.secp256k1.getPublicKey === 'function') {
        secpLib = window.secp256k1;
        return secpLib;
      }

      const mod = await import('../js/noble-secp256k1.browser.js');
      const lib = (mod && mod.default) ? (mod.default || mod) : mod;
      if (!lib || typeof lib.getPublicKey !== 'function') {
        throw new Error('No se pudo inicializar secp256k1');
      }

      window.nobleSecp256k1 = lib;
      window.secp256k1 = lib;
      secpLib = lib;
      return secpLib;
    }

    async function derivePublicKey(privateKeyHex) {
      const secp = await loadSecpLib();
      const pubKeyCompressed = secp.getPublicKey(privateKeyHex, true);
      const pubKeyUncompressed = secp.getPublicKey(privateKeyHex, false);

      return {
        compressed: typeof pubKeyCompressed === 'string' ? pubKeyCompressed : bytesToHex(pubKeyCompressed),
        uncompressed: typeof pubKeyUncompressed === 'string' ? pubKeyUncompressed : bytesToHex(pubKeyUncompressed)
      };
    }

    function extractCoordinates(uncompressedHex) {
      const x = uncompressedHex.substring(2, 66);
      const y = uncompressedHex.substring(66, 130);
      return { x: x, y: y };
    }

    function getYParity(yHex) {
      const lastChar = yHex.slice(-1).toLowerCase();
      const lastNibble = parseInt(lastChar, 16);
      return lastNibble % 2 === 0 ? 'par' : 'impar';
    }

    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.style.display = 'block';
      outputSection.style.display = 'none';
    }

    function hideError() {
      errorMessage.style.display = 'none';
    }

    async function derive() {
      const privateKey = privateKeyInput.value.replace(/[^0-9a-fA-F]/g, '').toLowerCase();
      const validation = isValidPrivateKey(privateKey);

      if (!validation.valid) {
        showError(validation.reason);
        return;
      }

      hideError();

      try {
        const publicKeys = await derivePublicKey(privateKey);
        const coords = extractCoordinates(publicKeys.uncompressed);
        const parity = getYParity(coords.y);

        outputCompressed.textContent = publicKeys.compressed;
        outputUncompressed.textContent = publicKeys.uncompressed;
        outputX.textContent = coords.x;
        outputY.textContent = coords.y;

        yParity.textContent = parity.toUpperCase();
        yParity.style.color = parity === 'par' ? '#2ea043' : '#58a6ff';

        const prefix = publicKeys.compressed.substring(0, 2);
        yParityExplanation.textContent = '-> prefijo ' + prefix + ' (' + (prefix === '02' ? 'Y par' : 'Y impar') + ')';

        outputSection.style.display = 'block';
      } catch (error) {
        showError('Error derivando clave publica: ' + error.message);
      }
    }

    privateKeyInput.addEventListener('input', function() {
      const value = privateKeyInput.value.replace(/[^0-9a-fA-F]/g, '');
      privateKeyInput.value = value;
      inputStatus.textContent = value.length + ' / 64 caracteres';
      inputStatus.style.color = value.length === 64 ? '#2ea043' : 'var(--text-secondary)';
    });

    btnGenerate.addEventListener('click', async function() {
      try {
        const privateKey = generateRandomPrivateKey();
        privateKeyInput.value = privateKey;
        inputStatus.textContent = '64 / 64 caracteres';
        inputStatus.style.color = '#2ea043';
        await derive();
      } catch (error) {
        showError('Error generando clave privada: ' + error.message);
      }
    });

    btnDerive.addEventListener('click', function() {
      derive();
    });

    privateKeyInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        derive();
      }
    });

    document.querySelectorAll('.copy-btn').forEach(function(btn) {
      btn.addEventListener('click', async function() {
        const targetId = btn.dataset.target;
        const target = document.getElementById(targetId);
        const text = target.textContent;

        if (text && text !== '‚Äî') {
          try {
            await navigator.clipboard.writeText(text);
            btn.textContent = '‚úì';
            setTimeout(function() { btn.textContent = 'üìã'; }, 1000);
          } catch (err) {
            console.error('Error copiando:', err);
          }
        }
      });
    });

    btnDerive.disabled = true;
    loadSecpLib().then(function() {
      btnDerive.disabled = false;
    }).catch(function(error) {
      showError('No se pudo cargar secp256k1: ' + error.message);
    });

  })();
  </script>
</body>
</html>